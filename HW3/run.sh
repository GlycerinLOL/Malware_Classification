# #!/bin/bash
# set -e
# cd "$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"/

DATE=`date +%Y%m%d`
run_name=_${DATE}_img_ta_adam_no_part
data_path="datasets/pcap_gray_img_ta"
# data_path="/data/brian92308/mal_detect/Midterm_Classification_Models/datasets/malwares_images_virus31320"
num_partition=3
optimizer="adam"

python server_adv.py --run_name=${run_name} &
sleep 15  # Sleep for 10s to give the server enough time to start and dowload the dataset

for i in `seq 0 2`; do
    echo "Starting client $i"
    python client_adv.py --client-id=${i} --dataset=${data_path} --num_partitions=${num_partition} --optimizer=${optimizer} &
done

# Enable CTRL+C to stop all background processes
trap "trap - SIGTERM && kill -- -$$" SIGINT SIGTERM
# Wait for all background processes to complete
wait